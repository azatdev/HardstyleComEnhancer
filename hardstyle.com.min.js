/* Unofficial Hardstyle.com Enhancer - Version 0.0.1, 2021-03-38 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.Dexie=e()}(this,function(){"use strict";var t=function(){return(t=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function e(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],a=0,s=o.length;a<s;a++,i++)r[i]=o[a];return r}var n=Object.keys,r=Array.isArray,i="undefined"!=typeof self?self:"undefined"!=typeof window?window:global;function o(t,e){return"object"!=typeof e?t:(n(e).forEach(function(n){t[n]=e[n]}),t)}"undefined"==typeof Promise||i.Promise||(i.Promise=Promise);var a=Object.getPrototypeOf,s={}.hasOwnProperty;function u(t,e){return s.call(t,e)}function c(t,e){"function"==typeof e&&(e=e(a(t))),n(e).forEach(function(n){f(t,n,e[n])})}var l=Object.defineProperty;function f(t,e,n,r){l(t,e,o(n&&u(n,"get")&&"function"==typeof n.get?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function h(t){return{from:function(e){return t.prototype=Object.create(e.prototype),f(t.prototype,"constructor",t),{extend:c.bind(null,t.prototype)}}}}var d=Object.getOwnPropertyDescriptor;function p(t,e){var n;return d(t,e)||(n=a(t))&&p(n,e)}var y=[].slice;function m(t,e,n){return y.call(t,e,n)}function v(t,e){return e(t)}function b(t){if(!t)throw new Error("Assertion Failed")}function g(t){i.setImmediate?setImmediate(t):setTimeout(t,0)}function w(t,e){return t.reduce(function(t,n,r){var i=e(n,r);return i&&(t[i[0]]=i[1]),t},{})}function _(t,e){if(u(t,e))return t[e];if(!e)return t;if("string"!=typeof e){for(var n=[],r=0,i=e.length;r<i;++r){var o=_(t,e[r]);n.push(o)}return n}var a=e.indexOf(".");if(-1!==a){var s=t[e.substr(0,a)];return void 0===s?void 0:_(s,e.substr(a+1))}}function k(t,e,n){if(t&&void 0!==e&&!("isFrozen"in Object&&Object.isFrozen(t)))if("string"!=typeof e&&"length"in e){b("string"!=typeof n&&"length"in n);for(var i=0,o=e.length;i<o;++i)k(t,e[i],n[i])}else{var a=e.indexOf(".");if(-1!==a){var s=e.substr(0,a),u=e.substr(a+1);if(""===u)void 0===n?r(t)&&!isNaN(parseInt(s))?t.splice(s,1):delete t[s]:t[s]=n;else{var c=t[s];c||(c=t[s]={}),k(c,u,n)}}else void 0===n?r(t)&&!isNaN(parseInt(e))?t.splice(e,1):delete t[e]:t[e]=n}}function x(t,e){"string"==typeof e?k(t,e,void 0):"length"in e&&[].map.call(e,function(e){k(t,e,void 0)})}function P(t){var e={};for(var n in t)u(t,n)&&(e[n]=t[n]);return e}var I=[].concat;function T(t){return I.apply([],t)}var A="Boolean,String,Date,RegExp,Blob,File,FileList,ArrayBuffer,DataView,Uint8ClampedArray,ImageData,Map,Set".split(",").concat(T([8,16,32,64].map(function(t){return["Int","Uint","Float"].map(function(e){return e+t+"Array"})}))).filter(function(t){return i[t]}),C=A.map(function(t){return i[t]}),E=w(A,function(t){return[t,!0]});function O(t){if(!t||"object"!=typeof t)return t;var e;if(r(t)){e=[];for(var n=0,i=t.length;n<i;++n)e.push(O(t[n]))}else if(C.indexOf(t.constructor)>=0)e=t;else for(var o in e=t.constructor?Object.create(t.constructor.prototype):{},t)u(t,o)&&(e[o]=O(t[o]));return e}var j={}.toString;function S(t){return j.call(t).slice(8,-1)}var K=function(t,e){return"Array"===e?""+t.map(function(t){return K(t,S(t))}):"ArrayBuffer"===e?""+new Uint8Array(t):"Date"===e?t.getTime():ArrayBuffer.isView(t)?""+new Uint8Array(t.buffer):t};function D(t,e,r,i){return r=r||{},i=i||"",n(t).forEach(function(n){if(u(e,n)){var o=t[n],a=e[n];if("object"==typeof o&&"object"==typeof a&&o&&a){var s=S(o),c=S(a);s===c?E[s]?K(o,s)!==K(a,c)&&(r[i+n]=e[n]):D(o,a,r,i+n+"."):r[i+n]=e[n]}else o!==a&&(r[i+n]=e[n])}else r[i+n]=void 0}),n(e).forEach(function(n){u(t,n)||(r[i+n]=e[n])}),r}var B="undefined"!=typeof Symbol&&Symbol.iterator,R=B?function(t){var e;return null!=t&&(e=t[B])&&e.apply(t)}:function(){return null},$={};function F(t){var e,n,i,o;if(1===arguments.length){if(r(t))return t.slice();if(this===$&&"string"==typeof t)return[t];if(o=R(t)){for(n=[];!(i=o.next()).done;)n.push(i.value);return n}if(null==t)return[t];if("number"==typeof(e=t.length)){for(n=new Array(e);e--;)n[e]=t[e];return n}return[t]}for(e=arguments.length,n=new Array(e);e--;)n[e]=arguments[e];return n}var q="undefined"!=typeof Symbol?function(t){return"AsyncFunction"===t[Symbol.toStringTag]}:function(){return!1},M="undefined"!=typeof location&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function N(t,e){M=t,L=e}var L=function(){return!0},U=!new Error("").stack;function W(){if(U)try{throw new Error}catch(t){return t}return new Error}function z(t,e){var n=t.stack;return n?(e=e||0,0===n.indexOf(t.name)&&(e+=(t.name+t.message).split("\n").length),n.split("\n").slice(e).filter(L).map(function(t){return"\n"+t}).join("")):""}var V=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],Y=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(V),H={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed"};function G(t,e){this._e=W(),this.name=t,this.message=e}function Q(t,e){return t+". Errors: "+Object.keys(e).map(function(t){return e[t].toString()}).filter(function(t,e,n){return n.indexOf(t)===e}).join("\n")}function X(t,e,n,r){this._e=W(),this.failures=e,this.failedKeys=r,this.successCount=n,this.message=Q(t,e)}function J(t,e){this._e=W(),this.name="BulkError",this.failures=e,this.message=Q(t,e)}h(G).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+z(this._e,2))}},toString:function(){return this.name+": "+this.message}}),h(X).from(G),h(J).from(G);var Z=Y.reduce(function(t,e){return t[e]=e+"Error",t},{}),tt=G,et=Y.reduce(function(t,e){var n=e+"Error";function r(t,r){this._e=W(),this.name=n,t?"string"==typeof t?(this.message=t+(r?"\n "+r:""),this.inner=r||null):"object"==typeof t&&(this.message=t.name+" "+t.message,this.inner=t):(this.message=H[e]||n,this.inner=null)}return h(r).from(tt),t[e]=r,t},{});et.Syntax=SyntaxError,et.Type=TypeError,et.Range=RangeError;var nt=V.reduce(function(t,e){return t[e+"Error"]=et[e],t},{});var rt=Y.reduce(function(t,e){return-1===["Syntax","Type","Range"].indexOf(e)&&(t[e+"Error"]=et[e]),t},{});function it(){}function ot(t){return t}function at(t,e){return null==t||t===ot?e:function(n){return e(t(n))}}function st(t,e){return function(){t.apply(this,arguments),e.apply(this,arguments)}}function ut(t,e){return t===it?e:function(){var n=t.apply(this,arguments);void 0!==n&&(arguments[0]=n);var r=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var o=e.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?st(r,this.onsuccess):r),i&&(this.onerror=this.onerror?st(i,this.onerror):i),void 0!==o?o:n}}function ct(t,e){return t===it?e:function(){t.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,e.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?st(n,this.onsuccess):n),r&&(this.onerror=this.onerror?st(r,this.onerror):r)}}function lt(t,e){return t===it?e:function(n){var r=t.apply(this,arguments);o(n,r);var i=this.onsuccess,a=this.onerror;this.onsuccess=null,this.onerror=null;var s=e.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?st(i,this.onsuccess):i),a&&(this.onerror=this.onerror?st(a,this.onerror):a),void 0===r?void 0===s?void 0:s:o(r,s)}}function ft(t,e){return t===it?e:function(){return!1!==e.apply(this,arguments)&&t.apply(this,arguments)}}function ht(t,e){return t===it?e:function(){var n=t.apply(this,arguments);if(n&&"function"==typeof n.then){for(var r=this,i=arguments.length,o=new Array(i);i--;)o[i]=arguments[i];return n.then(function(){return e.apply(r,o)})}return e.apply(this,arguments)}}rt.ModifyError=X,rt.DexieError=G,rt.BulkError=J;var dt={},pt=100,yt=100,mt="undefined"==typeof Promise?[]:function(){var t=Promise.resolve();if("undefined"==typeof crypto||!crypto.subtle)return[t,t.__proto__,t];var e=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[e,e.__proto__,t]}(),vt=mt[0],bt=mt[1],gt=mt[2],wt=bt&&bt.then,_t=vt&&vt.constructor,kt=!!gt,xt=!1,Pt=gt?function(){gt.then(zt)}:i.setImmediate?setImmediate.bind(null,zt):i.MutationObserver?function(){var t=document.createElement("div");new MutationObserver(function(){zt(),t=null}).observe(t,{attributes:!0}),t.setAttribute("i","1")}:function(){setTimeout(zt,0)},It=function(t,e){Dt.push([t,e]),At&&(Pt(),At=!1)},Tt=!0,At=!0,Ct=[],Et=[],Ot=null,jt=ot,St={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:ye,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach(function(t){try{ye(t[0],t[1])}catch(t){}})}},Kt=St,Dt=[],Bt=0,Rt=[];function $t(t){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=it,this._lib=!1;var e=this._PSD=Kt;if(M&&(this._stackHolder=W(),this._prev=null,this._numPrev=0),"function"!=typeof t){if(t!==dt)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(!1===this._state&&Mt(this,this._value))}this._state=null,this._value=null,++e.ref,function t(e,n){try{n(function(n){if(null===e._state){if(n===e)throw new TypeError("A promise cannot be resolved with itself.");var r=e._lib&&Vt();n&&"function"==typeof n.then?t(e,function(t,e){n instanceof $t?n._then(t,e):n.then(t,e)}):(e._state=!0,e._value=n,Nt(e)),r&&Yt()}},Mt.bind(null,e))}catch(t){Mt(e,t)}}(this,t)}var Ft={get:function(){var t=Kt,e=ee;function n(n,r){var i=this,o=!t.global&&(t!==Kt||e!==ee),a=o&&!oe(),s=new $t(function(e,s){Lt(i,new qt(he(n,t,o,a),he(r,t,o,a),e,s,t))});return M&&Wt(s,this),s}return n.prototype=dt,n},set:function(t){f(this,"then",t&&t.prototype===dt?Ft:{get:function(){return t},set:Ft.set})}};function qt(t,e,n,r,i){this.onFulfilled="function"==typeof t?t:null,this.onRejected="function"==typeof e?e:null,this.resolve=n,this.reject=r,this.psd=i}function Mt(t,e){if(Et.push(e),null===t._state){var n=t._lib&&Vt();e=jt(e),t._state=!1,t._value=e,M&&null!==e&&"object"==typeof e&&!e._promise&&function(t,e,n){try{t.apply(null,n)}catch(t){e&&e(t)}}(function(){var n=p(e,"stack");e._promise=t,f(e,"stack",{get:function(){return xt?n&&(n.get?n.get.apply(e):n.value):t.stack}})}),function(t){Ct.some(function(e){return e._value===t._value})||Ct.push(t)}(t),Nt(t),n&&Yt()}}function Nt(t){var e=t._listeners;t._listeners=[];for(var n=0,r=e.length;n<r;++n)Lt(t,e[n]);var i=t._PSD;--i.ref||i.finalize(),0===Bt&&(++Bt,It(function(){0==--Bt&&Ht()},[]))}function Lt(t,e){if(null!==t._state){var n=t._state?e.onFulfilled:e.onRejected;if(null===n)return(t._state?e.resolve:e.reject)(t._value);++e.psd.ref,++Bt,It(Ut,[n,t,e])}else t._listeners.push(e)}function Ut(t,e,n){try{Ot=e;var r,i=e._value;e._state?r=t(i):(Et.length&&(Et=[]),r=t(i),-1===Et.indexOf(i)&&function(t){var e=Ct.length;for(;e;)if(Ct[--e]._value===t._value)return void Ct.splice(e,1)}(e)),n.resolve(r)}catch(t){n.reject(t)}finally{Ot=null,0==--Bt&&Ht(),--n.psd.ref||n.psd.finalize()}}function Wt(t,e){var n=e?e._numPrev+1:0;n<pt&&(t._prev=e,t._numPrev=n)}function zt(){Vt()&&Yt()}function Vt(){var t=Tt;return Tt=!1,At=!1,t}function Yt(){var t,e,n;do{for(;Dt.length>0;)for(t=Dt,Dt=[],n=t.length,e=0;e<n;++e){var r=t[e];r[0].apply(null,r[1])}}while(Dt.length>0);Tt=!0,At=!0}function Ht(){var t=Ct;Ct=[],t.forEach(function(t){t._PSD.onunhandled.call(null,t._value,t)});for(var e=Rt.slice(0),n=e.length;n;)e[--n]()}function Gt(t){return new $t(dt,!1,t)}function Qt(t,e){var n=Kt;return function(){var r=Vt(),i=Kt;try{return ue(n,!0),t.apply(this,arguments)}catch(t){e&&e(t)}finally{ue(i,!1),r&&Yt()}}}c($t.prototype,{then:Ft,_then:function(t,e){Lt(this,new qt(null,null,t,e,Kt))},catch:function(t){if(1===arguments.length)return this.then(null,t);var e=arguments[0],n=arguments[1];return"function"==typeof e?this.then(null,function(t){return t instanceof e?n(t):Gt(t)}):this.then(null,function(t){return t&&t.name===e?n(t):Gt(t)})},finally:function(t){return this.then(function(e){return t(),e},function(e){return t(),Gt(e)})},stack:{get:function(){if(this._stack)return this._stack;try{xt=!0;var t=function t(e,n,r){if(n.length===r)return n;var i="";if(!1===e._state){var o,a,s=e._value;null!=s?(o=s.name||"Error",a=s.message||s,i=z(s,0)):(o=s,a=""),n.push(o+(a?": "+a:"")+i)}M&&((i=z(e._stackHolder,2))&&-1===n.indexOf(i)&&n.push(i),e._prev&&t(e._prev,n,r));return n}(this,[],20).join("\nFrom previous: ");return null!==this._state&&(this._stack=t),t}finally{xt=!1}}},timeout:function(t,e){var n=this;return t<1/0?new $t(function(r,i){var o=setTimeout(function(){return i(new et.Timeout(e))},t);n.then(r,i).finally(clearTimeout.bind(null,o))}):this}}),"undefined"!=typeof Symbol&&Symbol.toStringTag&&f($t.prototype,Symbol.toStringTag,"Dexie.Promise"),St.env=ce(),c($t,{resolve:function(t){if(t instanceof $t)return t;if(t&&"function"==typeof t.then)return new $t(function(e,n){t.then(e,n)});var e=new $t(dt,!0,t);return Wt(e,Ot),e},reject:Gt,race:function(){var t=F.apply(null,arguments).map(ae);return new $t(function(e,n){t.map(function(t){return $t.resolve(t).then(e,n)})})},PSD:{get:function(){return Kt},set:function(t){return Kt=t}},totalEchoes:{get:function(){return ee}},newPSD:re,usePSD:le,scheduler:{get:function(){return It},set:function(t){It=t}},rejectionMapper:{get:function(){return jt},set:function(t){jt=t}},follow:function(t,e){return new $t(function(n,r){return re(function(e,n){var r=Kt;r.unhandleds=[],r.onunhandled=n,r.finalize=st(function(){var t=this;!function(t){Rt.push(function e(){t();Rt.splice(Rt.indexOf(e),1)}),++Bt,It(function(){0==--Bt&&Ht()},[])}(function(){0===t.unhandleds.length?e():n(t.unhandleds[0])})},r.finalize),t()},e,n,r)})}}),_t&&(_t.allSettled&&f($t,"allSettled",function(){var t=F.apply(null,arguments).map(ae);return new $t(function(e){0===t.length&&e([]);var n=t.length,r=new Array(n);t.forEach(function(t,i){return $t.resolve(t).then(function(t){return r[i]={status:"fulfilled",value:t}},function(t){return r[i]={status:"rejected",reason:t}}).then(function(){return--n||e(r)})})})}),_t.any&&"undefined"!=typeof AggregateError&&f($t,"any",function(){var t=F.apply(null,arguments).map(ae);return new $t(function(e,n){0===t.length&&n(new AggregateError([]));var r=t.length,i=new Array(r);t.forEach(function(t,o){return $t.resolve(t).then(function(t){return e(t)},function(t){i[o]=t,--r||n(new AggregateError(i))})})})}));var Xt={awaits:0,echoes:0,id:0},Jt=0,Zt=[],te=0,ee=0,ne=0;function re(t,e,n,r){var i=Kt,a=Object.create(i);a.parent=i,a.ref=0,a.global=!1,a.id=++ne;var s=St.env;a.env=kt?{Promise:$t,PromiseProp:{value:$t,configurable:!0,writable:!0},all:$t.all,race:$t.race,allSettled:$t.allSettled,any:$t.any,resolve:$t.resolve,reject:$t.reject,nthen:de(s.nthen,a),gthen:de(s.gthen,a)}:{},e&&o(a,e),++i.ref,a.finalize=function(){--this.parent.ref||this.parent.finalize()};var u=le(a,t,n,r);return 0===a.ref&&a.finalize(),u}function ie(){return Xt.id||(Xt.id=++Jt),++Xt.awaits,Xt.echoes+=yt,Xt.id}function oe(){return!!Xt.awaits&&(0==--Xt.awaits&&(Xt.id=0),Xt.echoes=Xt.awaits*yt,!0)}function ae(t){return Xt.echoes&&t&&t.constructor===_t?(ie(),t.then(function(t){return oe(),t},function(t){return oe(),me(t)})):t}function se(){var t=Zt[Zt.length-1];Zt.pop(),ue(t,!1)}function ue(t,e){var n=Kt;if((e?!Xt.echoes||te++&&t===Kt:!te||--te&&t===Kt)||fe(e?function(t){++ee,Xt.echoes&&0!=--Xt.echoes||(Xt.echoes=Xt.id=0),Zt.push(Kt),ue(t,!0)}.bind(null,t):se),t!==Kt&&(Kt=t,n===St&&(St.env=ce()),kt)){var r=St.env.Promise,o=t.env;bt.then=o.nthen,r.prototype.then=o.gthen,(n.global||t.global)&&(Object.defineProperty(i,"Promise",o.PromiseProp),r.all=o.all,r.race=o.race,r.resolve=o.resolve,r.reject=o.reject,o.allSettled&&(r.allSettled=o.allSettled),o.any&&(r.any=o.any))}}function ce(){var t=i.Promise;return kt?{Promise:t,PromiseProp:Object.getOwnPropertyDescriptor(i,"Promise"),all:t.all,race:t.race,allSettled:t.allSettled,any:t.any,resolve:t.resolve,reject:t.reject,nthen:bt.then,gthen:t.prototype.then}:{}}function le(t,e,n,r,i){var o=Kt;try{return ue(t,!0),e(n,r,i)}finally{ue(o,!1)}}function fe(t){wt.call(vt,t)}function he(t,e,n,r){return"function"!=typeof t?t:function(){var i=Kt;n&&ie(),ue(e,!0);try{return t.apply(this,arguments)}finally{ue(i,!1),r&&fe(oe)}}}function de(t,e){return function(n,r){return t.call(this,he(n,e),he(r,e))}}-1===(""+wt).indexOf("[native code]")&&(ie=oe=it);var pe="unhandledrejection";function ye(t,e){var n;try{n=e.onuncatched(t)}catch(t){}if(!1!==n)try{var r,a={promise:e,reason:t};if(i.document&&document.createEvent?((r=document.createEvent("Event")).initEvent(pe,!0,!0),o(r,a)):i.CustomEvent&&o(r=new CustomEvent(pe,{detail:a}),a),r&&i.dispatchEvent&&(dispatchEvent(r),!i.PromiseRejectionEvent&&i.onunhandledrejection))try{i.onunhandledrejection(r)}catch(t){}M&&r&&!r.defaultPrevented&&console.warn("Unhandled rejection: "+(t.stack||t))}catch(t){}}var me=$t.reject;var ve=String.fromCharCode(65535),be="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",ge="String expected.",we=[],_e="undefined"!=typeof navigator&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),ke=_e,xe=_e,Pe=function(t){return!/(dexie\.js|dexie\.min\.js)/.test(t)},Ie="__dbnames";function Te(t,e){return t?e?function(){return t.apply(this,arguments)&&e.apply(this,arguments)}:t:e}var Ae={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1};function Ce(t){return function(e){return void 0===_(e,t)&&x(e=O(e),t),e}}var Ee=function(){function t(){}return t.prototype._trans=function(t,e,n){var r=this._tx||Kt.trans,i=this.name;function o(t,n,r){if(!r.schema[i])throw new et.NotFound("Table "+i+" not part of transaction");return e(r.idbtrans,r)}var a=Vt();try{return r&&r.db===this.db?r===Kt.trans?r._promise(t,o,n):re(function(){return r._promise(t,o,n)},{trans:r,transless:Kt.transless||Kt}):function t(e,n,r,i){if(e._state.openComplete||Kt.letThrough){var o=e._createTransaction(n,r,e._dbSchema);try{o.create()}catch(t){return me(t)}return o._promise(n,function(t,e){return re(function(){return Kt.trans=o,i(t,e,o)})}).then(function(t){return o._completion.then(function(){return t})})}if(!e._state.isBeingOpened){if(!e._options.autoOpen)return me(new et.DatabaseClosed);e.open().catch(it)}return e._state.dbReadyPromise.then(function(){return t(e,n,r,i)})}(this.db,t,[this.name],o)}finally{a&&Yt()}},t.prototype.get=function(t,e){var n=this;return t&&t.constructor===Object?this.where(t).first(e):this._trans("readonly",function(e){return n.core.get({trans:e,key:t}).then(function(t){return n.hook.reading.fire(t)})}).then(e)},t.prototype.where=function(t){if("string"==typeof t)return new this.db.WhereClause(this,t);if(r(t))return new this.db.WhereClause(this,"["+t.join("+")+"]");var e=n(t);if(1===e.length)return this.where(e[0]).equals(t[e[0]]);var i=this.schema.indexes.concat(this.schema.primKey).filter(function(t){return t.compound&&e.every(function(e){return t.keyPath.indexOf(e)>=0})&&t.keyPath.every(function(t){return e.indexOf(t)>=0})})[0];if(i&&this.db._maxKey!==ve)return this.where(i.name).equals(i.keyPath.map(function(e){return t[e]}));!i&&M&&console.warn("The query "+JSON.stringify(t)+" on "+this.name+" would benefit of a compound index ["+e.join("+")+"]");var o=this.schema.idxByName,a=this.db._deps.indexedDB;function s(t,e){try{return 0===a.cmp(t,e)}catch(t){return!1}}var u=e.reduce(function(e,n){var i=e[0],a=e[1],u=o[n],c=t[n];return[i||u,i||!u?Te(a,u&&u.multi?function(t){var e=_(t,n);return r(e)&&e.some(function(t){return s(c,t)})}:function(t){return s(c,_(t,n))}):a]},[null,null]),c=u[0],l=u[1];return c?this.where(c.name).equals(t[c.keyPath]).filter(l):i?this.filter(l):this.where(e).equals("")},t.prototype.filter=function(t){return this.toCollection().and(t)},t.prototype.count=function(t){return this.toCollection().count(t)},t.prototype.offset=function(t){return this.toCollection().offset(t)},t.prototype.limit=function(t){return this.toCollection().limit(t)},t.prototype.each=function(t){return this.toCollection().each(t)},t.prototype.toArray=function(t){return this.toCollection().toArray(t)},t.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},t.prototype.orderBy=function(t){return new this.db.Collection(new this.db.WhereClause(this,r(t)?"["+t.join("+")+"]":t))},t.prototype.reverse=function(){return this.toCollection().reverse()},t.prototype.mapToClass=function(t){this.schema.mappedClass=t;var e=function(e){if(!e)return e;var n=Object.create(t.prototype);for(var r in e)if(u(e,r))try{n[r]=e[r]}catch(t){}return n};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=e,this.hook("reading",e),t},t.prototype.defineClass=function(){return this.mapToClass(function(t){o(this,t)})},t.prototype.add=function(t,e){var n=this,r=this.schema.primKey,i=r.auto,o=r.keyPath,a=t;return o&&i&&(a=Ce(o)(t)),this._trans("readwrite",function(t){return n.core.mutate({trans:t,type:"add",keys:null!=e?[e]:null,values:[a]})}).then(function(t){return t.numFailures?$t.reject(t.failures[0]):t.lastResult}).then(function(e){if(o)try{k(t,o,e)}catch(t){}return e})},t.prototype.update=function(t,e){if("object"!=typeof e||r(e))throw new et.InvalidArgument("Modifications must be an object.");if("object"!=typeof t||r(t))return this.where(":id").equals(t).modify(e);n(e).forEach(function(n){k(t,n,e[n])});var i=_(t,this.schema.primKey.keyPath);return void 0===i?me(new et.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(i).modify(e)},t.prototype.put=function(t,e){var n=this,r=this.schema.primKey,i=r.auto,o=r.keyPath,a=t;return o&&i&&(a=Ce(o)(t)),this._trans("readwrite",function(t){return n.core.mutate({trans:t,type:"put",values:[a],keys:null!=e?[e]:null})}).then(function(t){return t.numFailures?$t.reject(t.failures[0]):t.lastResult}).then(function(e){if(o)try{k(t,o,e)}catch(t){}return e})},t.prototype.delete=function(t){var e=this;return this._trans("readwrite",function(n){return e.core.mutate({trans:n,type:"delete",keys:[t]})}).then(function(t){return t.numFailures?$t.reject(t.failures[0]):void 0})},t.prototype.clear=function(){var t=this;return this._trans("readwrite",function(e){return t.core.mutate({trans:e,type:"deleteRange",range:Ae})}).then(function(t){return t.numFailures?$t.reject(t.failures[0]):void 0})},t.prototype.bulkGet=function(t){var e=this;return this._trans("readonly",function(n){return e.core.getMany({keys:t,trans:n}).then(function(t){return t.map(function(t){return e.hook.reading.fire(t)})})})},t.prototype.bulkAdd=function(t,e,n){var r=this,i=Array.isArray(e)?e:void 0,o=(n=n||(i?void 0:e))?n.allKeys:void 0;return this._trans("readwrite",function(e){var n=r.schema.primKey,a=n.auto,s=n.keyPath;if(s&&i)throw new et.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(i&&i.length!==t.length)throw new et.InvalidArgument("Arguments objects and keys must have the same length");var u=t.length,c=s&&a?t.map(Ce(s)):t;return r.core.mutate({trans:e,type:"add",keys:i,values:c,wantResults:o}).then(function(t){var e=t.numFailures,n=t.results,i=t.lastResult,a=t.failures;if(0===e)return o?n:i;throw new J(r.name+".bulkAdd(): "+e+" of "+u+" operations failed",Object.keys(a).map(function(t){return a[t]}))})})},t.prototype.bulkPut=function(t,e,n){var r=this,i=Array.isArray(e)?e:void 0,o=(n=n||(i?void 0:e))?n.allKeys:void 0;return this._trans("readwrite",function(e){var n=r.schema.primKey,a=n.auto,s=n.keyPath;if(s&&i)throw new et.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(i&&i.length!==t.length)throw new et.InvalidArgument("Arguments objects and keys must have the same length");var u=t.length,c=s&&a?t.map(Ce(s)):t;return r.core.mutate({trans:e,type:"put",keys:i,values:c,wantResults:o}).then(function(t){var e=t.numFailures,n=t.results,i=t.lastResult,a=t.failures;if(0===e)return o?n:i;throw new J(r.name+".bulkPut(): "+e+" of "+u+" operations failed",Object.keys(a).map(function(t){return a[t]}))})})},t.prototype.bulkDelete=function(t){var e=this,n=t.length;return this._trans("readwrite",function(n){return e.core.mutate({trans:n,type:"delete",keys:t})}).then(function(t){var r=t.numFailures,i=t.lastResult,o=t.failures;if(0===r)return i;throw new J(e.name+".bulkDelete(): "+r+" of "+n+" operations failed",o)})},t}();function Oe(t){var e={},i=function(n,r){if(r){for(var i=arguments.length,o=new Array(i-1);--i;)o[i-1]=arguments[i];return e[n].subscribe.apply(null,o),t}if("string"==typeof n)return e[n]};i.addEventType=s;for(var o=1,a=arguments.length;o<a;++o)s(arguments[o]);return i;function s(t,o,a){if("object"!=typeof t){var u;o||(o=ft),a||(a=it);var c={subscribers:[],fire:a,subscribe:function(t){-1===c.subscribers.indexOf(t)&&(c.subscribers.push(t),c.fire=o(c.fire,t))},unsubscribe:function(t){c.subscribers=c.subscribers.filter(function(e){return e!==t}),c.fire=c.subscribers.reduce(o,a)}};return e[t]=i[t]=c,c}n(u=t).forEach(function(t){var e=u[t];if(r(e))s(t,u[t][0],u[t][1]);else{if("asap"!==e)throw new et.InvalidArgument("Invalid event config");var n=s(t,ot,function(){for(var t=arguments.length,e=new Array(t);t--;)e[t]=arguments[t];n.subscribers.forEach(function(t){g(function(){t.apply(null,e)})})})}})}}function je(t,e){return h(e).from({prototype:t}),e}function Se(t,e){return!(t.filter||t.algorithm||t.or)&&(e?t.justLimit:!t.replayFilter)}function Ke(t,e){t.filter=Te(t.filter,e)}function De(t,e,n){var r=t.replayFilter;t.replayFilter=r?function(){return Te(r(),e())}:e,t.justLimit=n&&!r}function Be(t,e){if(t.isPrimKey)return e.primaryKey;var n=e.getIndexByKeyPath(t.index);if(!n)throw new et.Schema("KeyPath "+t.index+" on object store "+e.name+" is not indexed");return n}function Re(t,e,n){var r=Be(t,e.schema);return e.openCursor({trans:n,values:!t.keysOnly,reverse:"prev"===t.dir,unique:!!t.unique,query:{index:r,range:t.range}})}function $e(t,e,n,r){var i=t.replayFilter?Te(t.filter,t.replayFilter()):t.filter;if(t.or){var o={},a=function(t,n,r){if(!i||i(n,r,function(t){return n.stop(t)},function(t){return n.fail(t)})){var a=n.primaryKey,s=""+a;"[object ArrayBuffer]"===s&&(s=""+new Uint8Array(a)),u(o,s)||(o[s]=!0,e(t,n,r))}};return Promise.all([t.or._iterate(a,n),Fe(Re(t,r,n),t.algorithm,a,!t.keysOnly&&t.valueMapper)])}return Fe(Re(t,r,n),Te(t.algorithm,i),e,!t.keysOnly&&t.valueMapper)}function Fe(t,e,n,r){var i=Qt(r?function(t,e,i){return n(r(t),e,i)}:n);return t.then(function(t){if(t)return t.start(function(){var n=function(){return t.continue()};e&&!e(t,function(t){return n=t},function(e){t.stop(e),n=it},function(e){t.fail(e),n=it})||i(t.value,t,function(t){return n=t}),n()})})}var qe=function(){function t(){}return t.prototype._read=function(t,e){var n=this._ctx;return n.error?n.table._trans(null,me.bind(null,n.error)):n.table._trans("readonly",t).then(e)},t.prototype._write=function(t){var e=this._ctx;return e.error?e.table._trans(null,me.bind(null,e.error)):e.table._trans("readwrite",t,"locked")},t.prototype._addAlgorithm=function(t){var e=this._ctx;e.algorithm=Te(e.algorithm,t)},t.prototype._iterate=function(t,e){return $e(this._ctx,t,e,this._ctx.table.core)},t.prototype.clone=function(t){var e=Object.create(this.constructor.prototype),n=Object.create(this._ctx);return t&&o(n,t),e._ctx=n,e},t.prototype.raw=function(){return this._ctx.valueMapper=null,this},t.prototype.each=function(t){var e=this._ctx;return this._read(function(n){return $e(e,t,n,e.table.core)})},t.prototype.count=function(t){var e=this;return this._read(function(t){var n=e._ctx,r=n.table.core;if(Se(n,!0))return r.count({trans:t,query:{index:Be(n,r.schema),range:n.range}}).then(function(t){return Math.min(t,n.limit)});var i=0;return $e(n,function(){return++i,!1},t,r).then(function(){return i})}).then(t)},t.prototype.sortBy=function(t,e){var n=t.split(".").reverse(),r=n[0],i=n.length-1;function o(t,e){return e?o(t[n[e]],e-1):t[r]}var a="next"===this._ctx.dir?1:-1;function s(t,e){var n=o(t,i),r=o(e,i);return n<r?-a:n>r?a:0}return this.toArray(function(t){return t.sort(s)}).then(e)},t.prototype.toArray=function(t){var e=this;return this._read(function(t){var n=e._ctx;if("next"===n.dir&&Se(n,!0)&&n.limit>0){var r=n.valueMapper,i=Be(n,n.table.core.schema);return n.table.core.query({trans:t,limit:n.limit,values:!0,query:{index:i,range:n.range}}).then(function(t){var e=t.result;return r?e.map(r):e})}var o=[];return $e(n,function(t){return o.push(t)},t,n.table.core).then(function(){return o})},t)},t.prototype.offset=function(t){var e=this._ctx;return t<=0?this:(e.offset+=t,Se(e)?De(e,function(){var e=t;return function(t,n){return 0===e||(1===e?(--e,!1):(n(function(){t.advance(e),e=0}),!1))}}):De(e,function(){var e=t;return function(){return--e<0}}),this)},t.prototype.limit=function(t){return this._ctx.limit=Math.min(this._ctx.limit,t),De(this._ctx,function(){var e=t;return function(t,n,r){return--e<=0&&n(r),e>=0}},!0),this},t.prototype.until=function(t,e){return Ke(this._ctx,function(n,r,i){return!t(n.value)||(r(i),e)}),this},t.prototype.first=function(t){return this.limit(1).toArray(function(t){return t[0]}).then(t)},t.prototype.last=function(t){return this.reverse().first(t)},t.prototype.filter=function(t){var e,n;return Ke(this._ctx,function(e){return t(e.value)}),e=this._ctx,n=t,e.isMatch=Te(e.isMatch,n),this},t.prototype.and=function(t){return this.filter(t)},t.prototype.or=function(t){return new this.db.WhereClause(this._ctx.table,t,this)},t.prototype.reverse=function(){return this._ctx.dir="prev"===this._ctx.dir?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},t.prototype.desc=function(){return this.reverse()},t.prototype.eachKey=function(t){var e=this._ctx;return e.keysOnly=!e.isMatch,this.each(function(e,n){t(n.key,n)})},t.prototype.eachUniqueKey=function(t){return this._ctx.unique="unique",this.eachKey(t)},t.prototype.eachPrimaryKey=function(t){var e=this._ctx;return e.keysOnly=!e.isMatch,this.each(function(e,n){t(n.primaryKey,n)})},t.prototype.keys=function(t){var e=this._ctx;e.keysOnly=!e.isMatch;var n=[];return this.each(function(t,e){n.push(e.key)}).then(function(){return n}).then(t)},t.prototype.primaryKeys=function(t){var e=this._ctx;if("next"===e.dir&&Se(e,!0)&&e.limit>0)return this._read(function(t){var n=Be(e,e.table.core.schema);return e.table.core.query({trans:t,values:!1,limit:e.limit,query:{index:n,range:e.range}})}).then(function(t){return t.result}).then(t);e.keysOnly=!e.isMatch;var n=[];return this.each(function(t,e){n.push(e.primaryKey)}).then(function(){return n}).then(t)},t.prototype.uniqueKeys=function(t){return this._ctx.unique="unique",this.keys(t)},t.prototype.firstKey=function(t){return this.limit(1).keys(function(t){return t[0]}).then(t)},t.prototype.lastKey=function(t){return this.reverse().firstKey(t)},t.prototype.distinct=function(){var t=this._ctx,e=t.index&&t.table.schema.idxByName[t.index];if(!e||!e.multi)return this;var n={};return Ke(this._ctx,function(t){var e=t.primaryKey.toString(),r=u(n,e);return n[e]=!0,!r}),this},t.prototype.modify=function(t){var e=this,r=this._ctx;return this._write(function(i){var o;if("function"==typeof t)o=t;else{var a=n(t),s=a.length;o=function(e){for(var n=!1,r=0;r<s;++r){var i=a[r],o=t[i];_(e,i)!==o&&(k(e,i,o),n=!0)}return n}}var u=r.table.core,c=u.schema.primaryKey,l=c.outbound,f=c.extractKey,h="testmode"in En?1:2e3,d=e.db.core.cmp,p=[],y=0,m=[],v=function(t,e){var r=e.failures,i=e.numFailures;y+=t-i;for(var o=0,a=n(r);o<a.length;o++){var s=a[o];p.push(r[s])}};return e.clone().primaryKeys().then(function(t){var e=function(n){var r=Math.min(h,t.length-n);return u.getMany({trans:i,keys:t.slice(n,n+r)}).then(function(a){for(var s=[],c=[],p=l?[]:null,y=[],m=0;m<r;++m){var b=a[m],g={value:O(b),primKey:t[n+m]};!1!==o.call(g,g.value,g)&&(null==g.value?y.push(t[n+m]):l||0===d(f(b),f(g.value))?(c.push(g.value),l&&p.push(t[n+m])):(y.push(t[n+m]),s.push(g.value)))}return Promise.resolve(s.length>0&&u.mutate({trans:i,type:"add",values:s}).then(function(t){for(var e in t.failures)y.splice(parseInt(e),1);v(s.length,t)})).then(function(t){return c.length>0&&u.mutate({trans:i,type:"put",keys:p,values:c}).then(function(t){return v(c.length,t)})}).then(function(){return y.length>0&&u.mutate({trans:i,type:"delete",keys:y}).then(function(t){return v(y.length,t)})}).then(function(){return t.length>n+r&&e(n+h)})})};return e(0).then(function(){if(p.length>0)throw new X("Error modifying one or more objects",p,y,m);return t.length})})})},t.prototype.delete=function(){var t=this._ctx,e=t.range;return Se(t)&&(t.isPrimKey&&!xe||3===e.type)?this._write(function(n){var r=t.table.core.schema.primaryKey,i=e;return t.table.core.count({trans:n,query:{index:r,range:i}}).then(function(e){return t.table.core.mutate({trans:n,type:"deleteRange",range:i}).then(function(t){var n=t.failures,r=(t.lastResult,t.results,t.numFailures);if(r)throw new X("Could not delete some values",Object.keys(n).map(function(t){return n[t]}),e-r);return e-r})})}):this.modify(function(t,e){return e.value=null})},t}();function Me(t,e){return t<e?-1:t===e?0:1}function Ne(t,e){return t>e?-1:t===e?0:1}function Le(t,e,n){var r=t instanceof He?new t.Collection(t):t;return r._ctx.error=n?new n(e):new TypeError(e),r}function Ue(t){return new t.Collection(t,function(){return Ye("")}).limit(0)}function We(t,e,n,r,i,o){for(var a=Math.min(t.length,r.length),s=-1,u=0;u<a;++u){var c=e[u];if(c!==r[u])return i(t[u],n[u])<0?t.substr(0,u)+n[u]+n.substr(u+1):i(t[u],r[u])<0?t.substr(0,u)+r[u]+n.substr(u+1):s>=0?t.substr(0,s)+e[s]+n.substr(s+1):null;i(t[u],c)<0&&(s=u)}return a<r.length&&"next"===o?t+n.substr(t.length):a<t.length&&"prev"===o?t.substr(0,n.length):s<0?null:t.substr(0,s)+r[s]+n.substr(s+1)}function ze(t,e,n,r){var i,o,a,s,u,c,l,f=n.length;if(!n.every(function(t){return"string"==typeof t}))return Le(t,ge);function h(t){i=function(t){return"next"===t?function(t){return t.toUpperCase()}:function(t){return t.toLowerCase()}}(t),o=function(t){return"next"===t?function(t){return t.toLowerCase()}:function(t){return t.toUpperCase()}}(t),a="next"===t?Me:Ne;var e=n.map(function(t){return{lower:o(t),upper:i(t)}}).sort(function(t,e){return a(t.lower,e.lower)});s=e.map(function(t){return t.upper}),u=e.map(function(t){return t.lower}),c=t,l="next"===t?"":r}h("next");var d=new t.Collection(t,function(){return Ve(s[0],u[f-1]+r)});d._ondirectionchange=function(t){h(t)};var p=0;return d._addAlgorithm(function(t,n,r){var i=t.key;if("string"!=typeof i)return!1;var h=o(i);if(e(h,u,p))return!0;for(var d=null,y=p;y<f;++y){var m=We(i,h,s[y],u[y],a,c);null===m&&null===d?p=y+1:(null===d||a(d,m)>0)&&(d=m)}return n(null!==d?function(){t.continue(d+l)}:r),!1}),d}function Ve(t,e,n,r){return{type:2,lower:t,upper:e,lowerOpen:n,upperOpen:r}}function Ye(t){return{type:1,lower:t,upper:t}}var He=function(){function t(){}return Object.defineProperty(t.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!0,configurable:!0}),t.prototype.between=function(t,e,n,r){n=!1!==n,r=!0===r;try{return this._cmp(t,e)>0||0===this._cmp(t,e)&&(n||r)&&(!n||!r)?Ue(this):new this.Collection(this,function(){return Ve(t,e,!n,!r)})}catch(t){return Le(this,be)}},t.prototype.equals=function(t){return null==t?Le(this,be):new this.Collection(this,function(){return Ye(t)})},t.prototype.above=function(t){return null==t?Le(this,be):new this.Collection(this,function(){return Ve(t,void 0,!0)})},t.prototype.aboveOrEqual=function(t){return null==t?Le(this,be):new this.Collection(this,function(){return Ve(t,void 0,!1)})},t.prototype.below=function(t){return null==t?Le(this,be):new this.Collection(this,function(){return Ve(void 0,t,!1,!0)})},t.prototype.belowOrEqual=function(t){return null==t?Le(this,be):new this.Collection(this,function(){return Ve(void 0,t)})},t.prototype.startsWith=function(t){return"string"!=typeof t?Le(this,ge):this.between(t,t+ve,!0,!0)},t.prototype.startsWithIgnoreCase=function(t){return""===t?this.startsWith(t):ze(this,function(t,e){return 0===t.indexOf(e[0])},[t],ve)},t.prototype.equalsIgnoreCase=function(t){return ze(this,function(t,e){return t===e[0]},[t],"")},t.prototype.anyOfIgnoreCase=function(){var t=F.apply($,arguments);return 0===t.length?Ue(this):ze(this,function(t,e){return-1!==e.indexOf(t)},t,"")},t.prototype.startsWithAnyOfIgnoreCase=function(){var t=F.apply($,arguments);return 0===t.length?Ue(this):ze(this,function(t,e){return e.some(function(e){return 0===t.indexOf(e)})},t,ve)},t.prototype.anyOf=function(){var t=this,e=F.apply($,arguments),n=this._cmp;try{e.sort(n)}catch(t){return Le(this,be)}if(0===e.length)return Ue(this);var r=new this.Collection(this,function(){return Ve(e[0],e[e.length-1])});r._ondirectionchange=function(r){n="next"===r?t._ascending:t._descending,e.sort(n)};var i=0;return r._addAlgorithm(function(t,r,o){for(var a=t.key;n(a,e[i])>0;)if(++i===e.length)return r(o),!1;return 0===n(a,e[i])||(r(function(){t.continue(e[i])}),!1)}),r},t.prototype.notEqual=function(t){return this.inAnyRange([[-1/0,t],[t,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},t.prototype.noneOf=function(){var t=F.apply($,arguments);if(0===t.length)return new this.Collection(this);try{t.sort(this._ascending)}catch(t){return Le(this,be)}var e=t.reduce(function(t,e){return t?t.concat([[t[t.length-1][1],e]]):[[-1/0,e]]},null);return e.push([t[t.length-1],this.db._maxKey]),this.inAnyRange(e,{includeLowers:!1,includeUppers:!1})},t.prototype.inAnyRange=function(t,e){var n=this,r=this._cmp,i=this._ascending,o=this._descending,a=this._min,s=this._max;if(0===t.length)return Ue(this);if(!t.every(function(t){return void 0!==t[0]&&void 0!==t[1]&&i(t[0],t[1])<=0}))return Le(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",et.InvalidArgument);var u=!e||!1!==e.includeLowers,c=e&&!0===e.includeUppers;var l,f=i;function h(t,e){return f(t[0],e[0])}try{(l=t.reduce(function(t,e){for(var n=0,i=t.length;n<i;++n){var o=t[n];if(r(e[0],o[1])<0&&r(e[1],o[0])>0){o[0]=a(o[0],e[0]),o[1]=s(o[1],e[1]);break}}return n===i&&t.push(e),t},[])).sort(h)}catch(t){return Le(this,be)}var d=0,p=c?function(t){return i(t,l[d][1])>0}:function(t){return i(t,l[d][1])>=0},y=u?function(t){return o(t,l[d][0])>0}:function(t){return o(t,l[d][0])>=0};var m=p,v=new this.Collection(this,function(){return Ve(l[0][0],l[l.length-1][1],!u,!c)});return v._ondirectionchange=function(t){"next"===t?(m=p,f=i):(m=y,f=o),l.sort(h)},v._addAlgorithm(function(t,e,r){for(var o=t.key;m(o);)if(++d===l.length)return e(r),!1;return!!function(t){return!p(t)&&!y(t)}(o)||0!==n._cmp(o,l[d][1])&&0!==n._cmp(o,l[d][0])&&(e(function(){f===i?t.continue(l[d][0]):t.continue(l[d][1])}),!1)}),v},t.prototype.startsWithAnyOf=function(){var t=F.apply($,arguments);return t.every(function(t){return"string"==typeof t})?0===t.length?Ue(this):this.inAnyRange(t.map(function(t){return[t,t+ve]})):Le(this,"startsWithAnyOf() only works with strings")},t}();function Ge(t){return 1===t.length?t[0]:t}function Qe(t){try{return t.only([[]]),[[]]}catch(t){return ve}}function Xe(t){return Qt(function(e){return Je(e),t(e.target.error),!1})}function Je(t){t.stopPropagation&&t.stopPropagation(),t.preventDefault&&t.preventDefault()}var Ze=function(){function t(){}return t.prototype._lock=function(){return b(!Kt.global),++this._reculock,1!==this._reculock||Kt.global||(Kt.lockOwnerFor=this),this},t.prototype._unlock=function(){if(b(!Kt.global),0==--this._reculock)for(Kt.global||(Kt.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var t=this._blockedFuncs.shift();try{le(t[1],t[0])}catch(t){}}return this},t.prototype._locked=function(){return this._reculock&&Kt.lockOwnerFor!==this},t.prototype.create=function(t){var e=this;if(!this.mode)return this;var n=this.db.idbdb,r=this.db._state.dbOpenError;if(b(!this.idbtrans),!t&&!n)switch(r&&r.name){case"DatabaseClosedError":throw new et.DatabaseClosed(r);case"MissingAPIError":throw new et.MissingAPI(r.message,r);default:throw new et.OpenFailed(r)}if(!this.active)throw new et.TransactionInactive;return b(null===this._completion._state),(t=this.idbtrans=t||n.transaction(Ge(this.storeNames),this.mode)).onerror=Qt(function(n){Je(n),e._reject(t.error)}),t.onabort=Qt(function(n){Je(n),e.active&&e._reject(new et.Abort(t.error)),e.active=!1,e.on("abort").fire(n)}),t.oncomplete=Qt(function(){e.active=!1,e._resolve()}),this},t.prototype._promise=function(t,e,n){var r=this;if("readwrite"===t&&"readwrite"!==this.mode)return me(new et.ReadOnly("Transaction is readonly"));if(!this.active)return me(new et.TransactionInactive);if(this._locked())return new $t(function(i,o){r._blockedFuncs.push([function(){r._promise(t,e,n).then(i,o)},Kt])});if(n)return re(function(){var t=new $t(function(t,n){r._lock();var i=e(t,n,r);i&&i.then&&i.then(t,n)});return t.finally(function(){return r._unlock()}),t._lib=!0,t});var i=new $t(function(t,n){var i=e(t,n,r);i&&i.then&&i.then(t,n)});return i._lib=!0,i},t.prototype._root=function(){return this.parent?this.parent._root():this},t.prototype.waitFor=function(t){var e=this._root(),n=$t.resolve(t);if(e._waitingFor)e._waitingFor=e._waitingFor.then(function(){return n});else{e._waitingFor=n,e._waitingQueue=[];var r=e.idbtrans.objectStore(e.storeNames[0]);!function t(){for(++e._spinCount;e._waitingQueue.length;)e._waitingQueue.shift()();e._waitingFor&&(r.get(-1/0).onsuccess=t)}()}var i=e._waitingFor;return new $t(function(t,r){n.then(function(n){return e._waitingQueue.push(Qt(t.bind(null,n)))},function(t){return e._waitingQueue.push(Qt(r.bind(null,t)))}).finally(function(){e._waitingFor===i&&(e._waitingFor=null)})})},t.prototype.abort=function(){this.active&&this._reject(new et.Abort),this.active=!1},t.prototype.table=function(t){var e=this._memoizedTables||(this._memoizedTables={});if(u(e,t))return e[t];var n=this.schema[t];if(!n)throw new et.NotFound("Table "+t+" not part of transaction");var r=new this.db.Table(t,n,this);return r.core=this.db.core.table(t),e[t]=r,r},t}();function tn(t,e,n,r,i,o,a){return{name:t,keyPath:e,unique:n,multi:r,auto:i,compound:o,src:(n&&!a?"&":"")+(r?"*":"")+(i?"++":"")+en(e)}}function en(t){return"string"==typeof t?t:t?"["+[].join.call(t,"+")+"]":""}function nn(t,e,n){return{name:t,primKey:e,indexes:n,mappedClass:null,idxByName:w(n,function(t){return[t.name,t]})}}function rn(t){return null==t?function(){}:"string"==typeof t?function(t){return 1===t.split(".").length?function(e){return e[t]}:function(e){return _(e,t)}}(t):function(e){return _(e,t)}}function on(t,e){return"delete"===e.type?e.keys:e.keys||e.values.map(t.extractKey)}function an(t){return[].slice.call(t)}var sn=0;function un(t){return null==t?":id":"string"==typeof t?t:"["+t.join("+")+"]"}function cn(t,n,i,o){var a=n.cmp.bind(n);function s(t){if(3===t.type)return null;if(4===t.type)throw new Error("Cannot convert never type to IDBKeyRange");var e=t.lower,n=t.upper,r=t.lowerOpen,o=t.upperOpen;return void 0===e?void 0===n?null:i.upperBound(n,!!o):void 0===n?i.lowerBound(e,!!r):i.bound(e,n,!!r,!!o)}var u=function(t,e){var n=an(t.objectStoreNames);return{schema:{name:t.name,tables:n.map(function(t){return e.objectStore(t)}).map(function(t){var e=t.keyPath,n=t.autoIncrement,i=r(e),o=null==e,a={},s={name:t.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:o,compound:i,keyPath:e,autoIncrement:n,unique:!0,extractKey:rn(e)},indexes:an(t.indexNames).map(function(e){return t.index(e)}).map(function(t){var e=t.name,n=t.unique,i=t.multiEntry,o=t.keyPath,s={name:e,compound:r(o),keyPath:o,unique:n,multiEntry:i,extractKey:rn(o)};return a[un(o)]=s,s}),getIndexByKeyPath:function(t){return a[un(t)]}};return a[":id"]=s.primaryKey,null!=e&&(a[un(e)]=s.primaryKey),s})},hasGetAll:n.length>0&&"getAll"in e.objectStore(n[0])&&!("undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}(t,o),c=u.schema,l=u.hasGetAll,f=c.tables.map(function(t){return function(t){var n=t.name;return{name:n,schema:t,mutate:function(r){var i=r.trans,o=r.type,a=r.keys,u=r.values,c=r.range,l=r.wantResults;return new Promise(function(r,f){r=Qt(r);var h=i.objectStore(n),d=null==h.keyPath,p="put"===o||"add"===o;if(!p&&"delete"!==o&&"deleteRange"!==o)throw new Error("Invalid operation type: "+o);var y=(a||u||{length:1}).length;if(a&&u&&a.length!==u.length)throw new Error("Given keys array must have same length as given values array.");if(0===y)return r({numFailures:0,failures:{},results:[],lastResult:void 0});var m,v=l&&e(a||on(t.primaryKey,{type:o,keys:a,values:u})),b=[],g=0,w=function(t){++g,Je(t),v&&(v[t.target._reqno]=void 0),b[t.target._reqno]=t.target.error},_=function(t){var e=t.target;v[e._reqno]=e.result};if("deleteRange"===o){if(4===c.type)return r({numFailures:g,failures:b,results:v,lastResult:void 0});m=3===c.type?h.clear():h.delete(s(c))}else{var k=p?d?[u,a]:[u,null]:[a,null],x=k[0],P=k[1];if(p)for(var I=0;I<y;++I)(m=P&&void 0!==P[I]?h[o](x[I],P[I]):h[o](x[I]))._reqno=I,v&&void 0===v[I]&&(m.onsuccess=_),m.onerror=w;else for(I=0;I<y;++I)(m=h[o](x[I]))._reqno=I,m.onerror=w}var T=function(t){var e=t.target.result;v&&(v[y-1]=e),r({numFailures:g,failures:b,results:v,lastResult:e})};m.onerror=function(t){w(t),T(t)},m.onsuccess=T})},getMany:function(t){var e=t.trans,r=t.keys;return new Promise(function(t,i){t=Qt(t);for(var o,a=e.objectStore(n),s=r.length,u=new Array(s),c=0,l=0,f=function(e){var n=e.target;u[n._pos]=n.result,++l===c&&t(u)},h=Xe(i),d=0;d<s;++d)null!=r[d]&&((o=a.get(r[d]))._pos=d,o.onsuccess=f,o.onerror=h,++c);0===c&&t(u)})},get:function(t){var e=t.trans,r=t.key;return new Promise(function(t,i){t=Qt(t);var o=e.objectStore(n).get(r);o.onsuccess=function(e){return t(e.target.result)},o.onerror=Xe(i)})},query:function(t){return function(e){return new Promise(function(r,i){r=Qt(r);var o=e.trans,a=e.values,u=e.limit,c=e.query,l=u===1/0?void 0:u,f=c.index,h=c.range,d=o.objectStore(n),p=f.isPrimaryKey?d:d.index(f.name),y=s(h);if(0===u)return r({result:[]});if(t){var m=a?p.getAll(y,l):p.getAllKeys(y,l);m.onsuccess=function(t){return r({result:t.target.result})},m.onerror=Xe(i)}else{var v=0,b=!a&&"openKeyCursor"in p?p.openKeyCursor(y):p.openCursor(y),g=[];b.onsuccess=function(t){var e=b.result;return e?(g.push(a?e.value:e.primaryKey),++v===u?r({result:g}):void e.continue()):r({result:g})},b.onerror=Xe(i)}})}}(l),openCursor:function(t){var e=t.trans,r=t.values,i=t.query,o=t.reverse,a=t.unique;return new Promise(function(t,u){t=Qt(t);var c=i.index,l=i.range,f=e.objectStore(n),h=c.isPrimaryKey?f:f.index(c.name),d=o?a?"prevunique":"prev":a?"nextunique":"next",p=!r&&"openKeyCursor"in h?h.openKeyCursor(s(l),d):h.openCursor(s(l),d);p.onerror=Xe(u),p.onsuccess=Qt(function(n){var r=p.result;if(r){r.___id=++sn,r.done=!1;var i=r.continue.bind(r),o=r.continuePrimaryKey;o&&(o=o.bind(r));var a=r.advance.bind(r),s=function(){throw new Error("Cursor not stopped")};r.trans=e,r.stop=r.continue=r.continuePrimaryKey=r.advance=function(){throw new Error("Cursor not started")},r.fail=Qt(u),r.next=function(){var t=this,e=1;return this.start(function(){return e--?t.continue():t.stop()}).then(function(){return t})},r.start=function(t){var e=new Promise(function(t,e){t=Qt(t),p.onerror=Xe(e),r.fail=e,r.stop=function(e){r.stop=r.continue=r.continuePrimaryKey=r.advance=s,t(e)}}),n=function(){if(p.result)try{t()}catch(t){r.fail(t)}else r.done=!0,r.start=function(){throw new Error("Cursor behind last entry")},r.stop()};return p.onsuccess=Qt(function(t){p.onsuccess=n,n()}),r.continue=i,r.continuePrimaryKey=o,r.advance=a,n(),e},t(r)}else t(null)},u)})},count:function(t){var e=t.query,r=t.trans,i=e.index,o=e.range;return new Promise(function(t,e){var a=r.objectStore(n),u=i.isPrimaryKey?a:a.index(i.name),c=s(o),l=c?u.count(c):u.count();l.onsuccess=Qt(function(e){return t(e.target.result)}),l.onerror=Xe(e)})}}}(t)}),h={};return f.forEach(function(t){return h[t.name]=t}),{stack:"dbcore",transaction:t.transaction.bind(t),table:function(t){if(!h[t])throw new Error("Table '"+t+"' not found");return h[t]},cmp:a,MIN_KEY:-1/0,MAX_KEY:Qe(i),schema:c}}function ln(e,n,r,i){var o=r.IDBKeyRange;return{dbcore:function(e,n){return n.reduce(function(e,n){var r=n.create;return t(t({},e),r(e))},e)}(cn(n,r.indexedDB,o,i),e.dbcore)}}function fn(t,e){var n=e.db,r=ln(t._middlewares,n,t._deps,e);t.core=r.dbcore,t.tables.forEach(function(e){var n=e.name;t.core.schema.tables.some(function(t){return t.name===n})&&(e.core=t.core.table(n),t[n]instanceof t.Table&&(t[n].core=e.core))})}function hn(t,e,n,r){n.forEach(function(n){var i=r[n];e.forEach(function(e){var r=p(e,n);(!r||"value"in r&&void 0===r.value)&&(e===t.Transaction.prototype||e instanceof t.Transaction?f(e,n,{get:function(){return this.table(n)},set:function(t){l(this,n,{value:t,writable:!0,configurable:!0,enumerable:!0})}}):e[n]=new t.Table(n,i))})})}function dn(t,e){e.forEach(function(e){for(var n in e)e[n]instanceof t.Table&&delete e[n]})}function pn(t,e){return t._cfg.version-e._cfg.version}function yn(t,e,r,i){var o=t._dbSchema,a=t._createTransaction("readwrite",t._storeNames,o);a.create(r),a._completion.catch(i);var s=a._reject.bind(a),u=Kt.transless||Kt;re(function(){Kt.trans=a,Kt.transless=u,0===e?(n(o).forEach(function(t){vn(r,t,o[t].primKey,o[t].indexes)}),fn(t,r),$t.follow(function(){return t.on.populate.fire(a)}).catch(s)):function(t,e,r,i){var o=[],a=t._versions,s=t._dbSchema=gn(t,t.idbdb,i),u=!1;return a.filter(function(t){return t._cfg.version>=e}).forEach(function(a){o.push(function(){var o=s,c=a._cfg.dbschema;wn(t,o,i),wn(t,c,i),s=t._dbSchema=c;var l=mn(o,c);l.add.forEach(function(t){vn(i,t[0],t[1].primKey,t[1].indexes)}),l.change.forEach(function(t){if(t.recreate)throw new et.Upgrade("Not yet support for changing primary key");var e=i.objectStore(t.name);t.add.forEach(function(t){return bn(e,t)}),t.change.forEach(function(t){e.deleteIndex(t.name),bn(e,t)}),t.del.forEach(function(t){return e.deleteIndex(t)})});var f=a._cfg.contentUpgrade;if(f&&a._cfg.version>e){fn(t,i),r._memoizedTables={},u=!0;var h=P(c);l.del.forEach(function(t){h[t]=o[t]}),dn(t,[t.Transaction.prototype]),hn(t,[t.Transaction.prototype],n(h),h),r.schema=h;var d,p=q(f);p&&ie();var y=$t.follow(function(){if((d=f(r))&&p){var t=oe.bind(null,null);d.then(t,t)}});return d&&"function"==typeof d.then?$t.resolve(d):y.then(function(){return d})}}),o.push(function(e){u&&ke||function(t,e){for(var n=0;n<e.db.objectStoreNames.length;++n){var r=e.db.objectStoreNames[n];null==t[r]&&e.db.deleteObjectStore(r)}}(a._cfg.dbschema,e),dn(t,[t.Transaction.prototype]),hn(t,[t.Transaction.prototype],t._storeNames,t._dbSchema),r.schema=t._dbSchema})}),function t(){return o.length?$t.resolve(o.shift()(r.idbtrans)).then(t):$t.resolve()}().then(function(){var t,e;e=i,n(t=s).forEach(function(n){e.db.objectStoreNames.contains(n)||vn(e,n,t[n].primKey,t[n].indexes)})})}(t,e,a,r).catch(s)})}function mn(t,e){var n,r={del:[],add:[],change:[]};for(n in t)e[n]||r.del.push(n);for(n in e){var i=t[n],o=e[n];if(i){var a={name:n,def:o,recreate:!1,del:[],add:[],change:[]};if(""+(i.primKey.keyPath||"")!=""+(o.primKey.keyPath||"")||i.primKey.auto!==o.primKey.auto&&!_e)a.recreate=!0,r.change.push(a);else{var s=i.idxByName,u=o.idxByName,c=void 0;for(c in s)u[c]||a.del.push(c);for(c in u){var l=s[c],f=u[c];l?l.src!==f.src&&a.change.push(f):a.add.push(f)}(a.del.length>0||a.add.length>0||a.change.length>0)&&r.change.push(a)}}else r.add.push([n,o])}return r}function vn(t,e,n,r){var i=t.db.createObjectStore(e,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach(function(t){return bn(i,t)}),i}function bn(t,e){t.createIndex(e.name,e.keyPath,{unique:e.unique,multiEntry:e.multi})}function gn(t,e,n){var r={};return m(e.objectStoreNames,0).forEach(function(t){for(var e=n.objectStore(t),i=e.keyPath,o=tn(en(i),i||"",!1,!1,!!e.autoIncrement,i&&"string"!=typeof i,!0),a=[],s=0;s<e.indexNames.length;++s){var u=e.index(e.indexNames[s]);i=u.keyPath;var c=tn(u.name,i,!!u.unique,!!u.multiEntry,!1,i&&"string"!=typeof i,!1);a.push(c)}r[t]=nn(t,o,a)}),r}function wn(t,e,n){for(var r=n.db.objectStoreNames,o=0;o<r.length;++o){var a=r[o],s=n.objectStore(a);t._hasGetAll="getAll"in s;for(var u=0;u<s.indexNames.length;++u){var c=s.indexNames[u],l=s.index(c).keyPath,f="string"==typeof l?l:"["+m(l).join("+")+"]";if(e[a]){var h=e[a].idxByName[f];h&&(h.name=c,delete e[a].idxByName[f],e[a].idxByName[c]=h)}}}"undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&i.WorkerGlobalScope&&i instanceof i.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(t._hasGetAll=!1)}var _n,kn=function(){function t(){}return t.prototype._parseStoresSpec=function(t,e){n(t).forEach(function(n){if(null!==t[n]){var i=t[n].split(",").map(function(t,e){var n=(t=t.trim()).replace(/([&*]|\+\+)/g,""),i=/^\[/.test(n)?n.match(/^\[(.*)\]$/)[1].split("+"):n;return tn(n,i||null,/\&/.test(t),/\*/.test(t),/\+\+/.test(t),r(i),0===e)}),o=i.shift();if(o.multi)throw new et.Schema("Primary key cannot be multi-valued");i.forEach(function(t){if(t.auto)throw new et.Schema("Only primary key can be marked as autoIncrement (++)");if(!t.keyPath)throw new et.Schema("Index must have a name and cannot be an empty string")}),e[n]=nn(n,o,i)}})},t.prototype.stores=function(t){var e=this.db;this._cfg.storesSource=this._cfg.storesSource?o(this._cfg.storesSource,t):t;var r=e._versions,i={},a={};return r.forEach(function(t){o(i,t._cfg.storesSource),a=t._cfg.dbschema={},t._parseStoresSpec(i,a)}),e._dbSchema=a,dn(e,[e._allTables,e,e.Transaction.prototype]),hn(e,[e._allTables,e,e.Transaction.prototype,this._cfg.tables],n(a),a),e._storeNames=n(a),this},t.prototype.upgrade=function(t){return this._cfg.contentUpgrade=t,this},t}();function xn(t){return re(function(){return Kt.letThrough=!0,t()})}function Pn(t){var e=t._state,r=t._deps.indexedDB;if(e.isBeingOpened||t.idbdb)return e.dbReadyPromise.then(function(){return e.dbOpenError?me(e.dbOpenError):t});M&&(e.openCanceller._stackHolder=W()),e.isBeingOpened=!0,e.dbOpenError=null,e.openComplete=!1;var i=e.dbReadyResolve,o=null;return $t.race([e.openCanceller,new $t(function(i,a){if(!r)throw new et.MissingAPI("indexedDB API not found. If using IE10+, make sure to run your code on a server URL (not locally). If using old Safari versions, make sure to include indexedDB polyfill.");var s=t.name,u=e.autoSchema?r.open(s):r.open(s,Math.round(10*t.verno));if(!u)throw new et.MissingAPI("IndexedDB API not available");u.onerror=Xe(a),u.onblocked=Qt(t._fireOnBlocked),u.onupgradeneeded=Qt(function(n){if(o=u.transaction,e.autoSchema&&!t._options.allowEmptyDB){u.onerror=Je,o.abort(),u.result.close();var i=r.deleteDatabase(s);i.onsuccess=i.onerror=Qt(function(){a(new et.NoSuchDatabase("Database "+s+" doesnt exist"))})}else{o.onerror=Xe(a);var c=n.oldVersion>Math.pow(2,62)?0:n.oldVersion;t.idbdb=u.result,yn(t,c/10,o,a)}},a),u.onsuccess=Qt(function(){o=null;var r=t.idbdb=u.result,a=m(r.objectStoreNames);if(a.length>0)try{var c=r.transaction(Ge(a),"readonly");e.autoSchema?function(t,e,r){t.verno=e.version/10;var i=t._dbSchema=gn(0,e,r);t._storeNames=m(e.objectStoreNames,0),hn(t,[t._allTables],n(i),i)}(t,r,c):(wn(t,t._dbSchema,c),function(t,e){var n=mn(gn(0,t.idbdb,e),t._dbSchema);return!(n.add.length||n.change.some(function(t){return t.add.length||t.change.length}))}(t,c)||console.warn("Dexie SchemaDiff: Schema was extended without increasing the number passed to db.version(). Some queries may fail.")),fn(t,c)}catch(t){}we.push(t),r.onversionchange=Qt(function(n){e.vcFired=!0,t.on("versionchange").fire(n)}),_n.add(s),i()},a)})]).then(function(){return e.onReadyBeingFired=[],$t.resolve(xn(t.on.ready.fire)).then(function t(){if(e.onReadyBeingFired.length>0){var n=e.onReadyBeingFired.reduce(ht,it);return e.onReadyBeingFired=[],$t.resolve(xn(n)).then(t)}})}).finally(function(){e.onReadyBeingFired=null}).then(function(){return e.isBeingOpened=!1,t}).catch(function(n){try{o&&o.abort()}catch(t){}return e.isBeingOpened=!1,t.close(),e.dbOpenError=n,me(e.dbOpenError)}).finally(function(){e.openComplete=!0,i()})}function In(t){var e=function(e){return t.next(e)},n=o(e),i=o(function(e){return t.throw(e)});function o(t){return function(e){var o=t(e),a=o.value;return o.done?a:a&&"function"==typeof a.then?a.then(n,i):r(a)?Promise.all(a).then(n,i):n(a)}}return o(e)()}function Tn(t,e,n){for(var i=r(t)?t.slice():[t],o=0;o<n;++o)i.push(e);return i}var An={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(e){return t(t({},e),{table:function(n){var r=e.table(n),i=r.schema,o={},a=[];function s(e,n,r){var i=un(e),u=o[i]=o[i]||[],c=null==e?0:"string"==typeof e?1:e.length,l=n>0,f=t(t({},r),{isVirtual:l,isPrimaryKey:!l&&r.isPrimaryKey,keyTail:n,keyLength:c,extractKey:rn(e),unique:!l&&r.unique});return u.push(f),f.isPrimaryKey||a.push(f),c>1&&s(2===c?e[0]:e.slice(0,c-1),n+1,r),u.sort(function(t,e){return t.keyTail-e.keyTail}),f}var u=s(i.primaryKey.keyPath,0,i.primaryKey);o[":id"]=[u];for(var c=0,l=i.indexes;c<l.length;c++){var f=l[c];s(f.keyPath,0,f)}function h(n){var r,i,o=n.query.index;return o.isVirtual?t(t({},n),{query:{index:o,range:(r=n.query.range,i=o.keyTail,{type:1===r.type?2:r.type,lower:Tn(r.lower,r.lowerOpen?e.MAX_KEY:e.MIN_KEY,i),lowerOpen:!0,upper:Tn(r.upper,r.upperOpen?e.MIN_KEY:e.MAX_KEY,i),upperOpen:!0})}}):n}return t(t({},r),{schema:t(t({},i),{primaryKey:u,indexes:a,getIndexByKeyPath:function(t){var e=o[un(t)];return e&&e[0]}}),count:function(t){return r.count(h(t))},query:function(t){return r.query(h(t))},openCursor:function(t){var n=t.query.index,i=n.keyTail,o=n.isVirtual,a=n.keyLength;return o?r.openCursor(h(t)).then(function(n){return n&&function(n){return Object.create(n,{continue:{value:function(r){null!=r?n.continue(Tn(r,t.reverse?e.MAX_KEY:e.MIN_KEY,i)):t.unique?n.continue(Tn(n.key,t.reverse?e.MIN_KEY:e.MAX_KEY,i)):n.continue()}},continuePrimaryKey:{value:function(t,r){n.continuePrimaryKey(Tn(t,e.MAX_KEY,i),r)}},key:{get:function(){var t=n.key;return 1===a?t[0]:t.slice(0,a)}},value:{get:function(){return n.value}}})}(n)}):r.openCursor(t)}})}})}},Cn={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(n){return t(t({},n),{table:function(r){var i=n.table(r),o=i.schema.primaryKey;return t(t({},i),{mutate:function(n){var a=Kt.trans,s=a.table(r).hook,c=s.deleting,l=s.creating,f=s.updating;switch(n.type){case"add":if(l.fire===it)break;return a._promise("readwrite",function(){return h(n)},!0);case"put":if(l.fire===it&&f.fire===it)break;return a._promise("readwrite",function(){return h(n)},!0);case"delete":if(c.fire===it)break;return a._promise("readwrite",function(){return h(n)},!0);case"deleteRange":if(c.fire===it)break;return a._promise("readwrite",function(){return function(e){return function e(n,r,a){return i.query({trans:n,values:!1,query:{index:o,range:r},limit:a}).then(function(i){var o=i.result;return h({type:"delete",keys:o,trans:n}).then(function(i){return i.numFailures>0?Promise.reject(i.failures[0]):o.length<a?{failures:[],numFailures:0,lastResult:void 0}:e(n,t(t({},r),{lower:o[o.length-1],lowerOpen:!0}),a)})})}(e.trans,e.range,1e4)}(n)},!0)}return i.mutate(n);function h(n){var r=Kt.trans,a=n.keys||on(o,n);if(!a)throw new Error("Keys missing");return"delete"!==(n="add"===n.type||"put"===n.type?t(t({},n),{keys:a,wantResults:!0}):t({},n)).type&&(n.values=e(n.values)),n.keys&&(n.keys=e(n.keys)),function(t,e,n){return"add"===e.type?Promise.resolve(new Array(e.values.length)):t.getMany({trans:e.trans,keys:n})}(i,n,a).then(function(t){var e=a.map(function(e,i){var a=t[i],s={onerror:null,onsuccess:null};if("delete"===n.type)c.fire.call(s,e,a,r);else if("add"===n.type||void 0===a){var h=l.fire.call(s,e,n.values[i],r);null==e&&null!=h&&(e=h,n.keys[i]=e,o.outbound||k(n.values[i],o.keyPath,e))}else{var d=D(a,n.values[i]),p=f.fire.call(s,d,e,a,r);if(p){var y=n.values[i];Object.keys(p).forEach(function(t){u(y,t)?y[t]=p[t]:k(y,t,p[t])})}}return s});return i.mutate(n).then(function(r){for(var i=r.failures,o=r.results,s=r.numFailures,u=r.lastResult,c=0;c<a.length;++c){var l=o?o[c]:a[c],f=e[c];null==l?f.onerror&&f.onerror(i[c]):f.onsuccess&&f.onsuccess("put"===n.type&&t[c]?n.values[c]:l)}return{failures:i,results:o,numFailures:s,lastResult:u}}).catch(function(t){return e.forEach(function(e){return e.onerror&&e.onerror(t)}),Promise.reject(t)})})}}})}})}},En=function(){function e(n,r){var i=this;this._middlewares={},this.verno=0;var o=e.dependencies;this._options=r=t({addons:e.addons,autoOpen:!0,indexedDB:o.indexedDB,IDBKeyRange:o.IDBKeyRange},r),this._deps={indexedDB:r.indexedDB,IDBKeyRange:r.IDBKeyRange};var a=r.addons;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null;var s,u={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:it,dbReadyPromise:null,cancelOpen:it,openCanceller:null,autoSchema:!0};u.dbReadyPromise=new $t(function(t){u.dbReadyResolve=t}),u.openCanceller=new $t(function(t,e){u.cancelOpen=e}),this._state=u,this.name=n,this.on=Oe(this,"populate","blocked","versionchange",{ready:[ht,it]}),this.on.ready.subscribe=v(this.on.ready.subscribe,function(t){return function(n,r){e.vip(function(){var e=i._state;if(e.openComplete)e.dbOpenError||$t.resolve().then(n),r&&t(n);else if(e.onReadyBeingFired)e.onReadyBeingFired.push(n),r&&t(n);else{t(n);var o=i;r||t(function t(){o.on.ready.unsubscribe(n),o.on.ready.unsubscribe(t)})}})}}),this.Collection=(s=this,je(qe.prototype,function(t,e){this.db=s;var n=Ae,r=null;if(e)try{n=e()}catch(t){r=t}var i=t._ctx,o=i.table,a=o.hook.reading.fire;this._ctx={table:o,index:i.index,isPrimKey:!i.index||o.schema.primKey.keyPath&&i.index===o.schema.primKey.name,range:n,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:r,or:i.or,valueMapper:a!==ot?a:null}})),this.Table=function(t){return je(Ee.prototype,function(e,n,r){this.db=t,this._tx=r,this.name=e,this.schema=n,this.hook=t._allTables[e]?t._allTables[e].hook:Oe(null,{creating:[ut,it],reading:[at,ot],updating:[lt,it],deleting:[ct,it]})})}(this),this.Transaction=function(t){return je(Ze.prototype,function(e,n,r,i){var o=this;this.db=t,this.mode=e,this.storeNames=n,this.schema=r,this.idbtrans=null,this.on=Oe(this,"complete","error","abort"),this.parent=i||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new $t(function(t,e){o._resolve=t,o._reject=e}),this._completion.then(function(){o.active=!1,o.on.complete.fire()},function(t){var e=o.active;return o.active=!1,o.on.error.fire(t),o.parent?o.parent._reject(t):e&&o.idbtrans&&o.idbtrans.abort(),me(t)})})}(this),this.Version=function(t){return je(kn.prototype,function(e){this.db=t,this._cfg={version:e,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}})}(this),this.WhereClause=function(t){return je(He.prototype,function(e,n,r){this.db=t,this._ctx={table:e,index:":id"===n?null:n,or:r};var i=t._deps.indexedDB;if(!i)throw new et.MissingAPI("indexedDB API missing");this._cmp=this._ascending=i.cmp.bind(i),this._descending=function(t,e){return i.cmp(e,t)},this._max=function(t,e){return i.cmp(t,e)>0?t:e},this._min=function(t,e){return i.cmp(t,e)<0?t:e},this._IDBKeyRange=t._deps.IDBKeyRange})}(this),this.on("versionchange",function(t){t.newVersion>0?console.warn("Another connection wants to upgrade database '"+i.name+"'. Closing db now to resume the upgrade."):console.warn("Another connection wants to delete database '"+i.name+"'. Closing db now to resume the delete request."),i.close()}),this.on("blocked",function(t){!t.newVersion||t.newVersion<t.oldVersion?console.warn("Dexie.delete('"+i.name+"') was blocked"):console.warn("Upgrade '"+i.name+"' blocked by other connection holding version "+t.oldVersion/10)}),this._maxKey=Qe(r.IDBKeyRange),this._createTransaction=function(t,e,n,r){return new i.Transaction(t,e,n,r)},this._fireOnBlocked=function(t){i.on("blocked").fire(t),we.filter(function(t){return t.name===i.name&&t!==i&&!t._state.vcFired}).map(function(e){return e.on("versionchange").fire(t)})},this.use(An),this.use(Cn),a.forEach(function(t){return t(i)})}return e.prototype.version=function(t){if(isNaN(t)||t<.1)throw new et.Type("Given version is not a positive number");if(t=Math.round(10*t)/10,this.idbdb||this._state.isBeingOpened)throw new et.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,t);var e=this._versions,n=e.filter(function(e){return e._cfg.version===t})[0];return n||(n=new this.Version(t),e.push(n),e.sort(pn),n.stores({}),this._state.autoSchema=!1,n)},e.prototype._whenReady=function(t){var e=this;return this._state.openComplete||Kt.letThrough?t():new $t(function(t,n){if(!e._state.isBeingOpened){if(!e._options.autoOpen)return void n(new et.DatabaseClosed);e.open().catch(it)}e._state.dbReadyPromise.then(t,n)}).then(t)},e.prototype.use=function(t){var e=t.stack,n=t.create,r=t.level,i=t.name;i&&this.unuse({stack:e,name:i});var o=this._middlewares[e]||(this._middlewares[e]=[]);return o.push({stack:e,create:n,level:null==r?10:r,name:i}),o.sort(function(t,e){return t.level-e.level}),this},e.prototype.unuse=function(t){var e=t.stack,n=t.name,r=t.create;return e&&this._middlewares[e]&&(this._middlewares[e]=this._middlewares[e].filter(function(t){return r?t.create!==r:!!n&&t.name!==n})),this},e.prototype.open=function(){return Pn(this)},e.prototype.close=function(){var t=we.indexOf(this),e=this._state;if(t>=0&&we.splice(t,1),this.idbdb){try{this.idbdb.close()}catch(t){}this.idbdb=null}this._options.autoOpen=!1,e.dbOpenError=new et.DatabaseClosed,e.isBeingOpened&&e.cancelOpen(e.dbOpenError),e.dbReadyPromise=new $t(function(t){e.dbReadyResolve=t}),e.openCanceller=new $t(function(t,n){e.cancelOpen=n})},e.prototype.delete=function(){var t=this,e=arguments.length>0,n=this._state;return new $t(function(r,i){var o=function(){t.close();var e=t._deps.indexedDB.deleteDatabase(t.name);e.onsuccess=Qt(function(){_n.remove(t.name),r()}),e.onerror=Xe(i),e.onblocked=t._fireOnBlocked};if(e)throw new et.InvalidArgument("Arguments not allowed in db.delete()");n.isBeingOpened?n.dbReadyPromise.then(o):o()})},e.prototype.backendDB=function(){return this.idbdb},e.prototype.isOpen=function(){return null!==this.idbdb},e.prototype.hasBeenClosed=function(){var t=this._state.dbOpenError;return t&&"DatabaseClosed"===t.name},e.prototype.hasFailed=function(){return null!==this._state.dbOpenError},e.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(e.prototype,"tables",{get:function(){var t=this;return n(this._allTables).map(function(e){return t._allTables[e]})},enumerable:!0,configurable:!0}),e.prototype.transaction=function(){var t=function(t,e,n){var r=arguments.length;if(r<2)throw new et.InvalidArgument("Too few arguments");for(var i=new Array(r-1);--r;)i[r-1]=arguments[r];return n=i.pop(),[t,T(i),n]}.apply(this,arguments);return this._transaction.apply(this,t)},e.prototype._transaction=function(t,e,n){var r=this,i=Kt.trans;i&&i.db===this&&-1===t.indexOf("!")||(i=null);var o,a,s=-1!==t.indexOf("?");t=t.replace("!","").replace("?","");try{if(a=e.map(function(t){var e=t instanceof r.Table?t.name:t;if("string"!=typeof e)throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return e}),"r"==t||"readonly"===t)o="readonly";else{if("rw"!=t&&"readwrite"!=t)throw new et.InvalidArgument("Invalid transaction mode: "+t);o="readwrite"}if(i){if("readonly"===i.mode&&"readwrite"===o){if(!s)throw new et.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");i=null}i&&a.forEach(function(t){if(i&&-1===i.storeNames.indexOf(t)){if(!s)throw new et.SubTransaction("Table "+t+" not included in parent transaction.");i=null}}),s&&i&&!i.active&&(i=null)}}catch(t){return i?i._promise(null,function(e,n){n(t)}):me(t)}var u=function(t,e,n,r,i){return $t.resolve().then(function(){var o=Kt.transless||Kt,a=t._createTransaction(e,n,t._dbSchema,r),s={trans:a,transless:o};r?a.idbtrans=r.idbtrans:a.create();var u,c=q(i);c&&ie();var l=$t.follow(function(){if(u=i.call(a,a))if(c){var t=oe.bind(null,null);u.then(t,t)}else"function"==typeof u.next&&"function"==typeof u.throw&&(u=In(u))},s);return(u&&"function"==typeof u.then?$t.resolve(u).then(function(t){return a.active?t:me(new et.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))}):l.then(function(){return u})).then(function(t){return r&&a._resolve(),a._completion.then(function(){return t})}).catch(function(t){return a._reject(t),me(t)})})}.bind(null,this,o,a,i,n);return i?i._promise(o,u,"lock"):Kt.trans?le(Kt.transless,function(){return r._whenReady(u)}):this._whenReady(u)},e.prototype.table=function(t){if(!u(this._allTables,t))throw new et.InvalidTable("Table "+t+" does not exist");return this._allTables[t]},e}(),On=En;return c(On,t(t({},rt),{delete:function(t){return new On(t).delete()},exists:function(t){return new On(t,{addons:[]}).open().then(function(t){return t.close(),!0}).catch("NoSuchDatabaseError",function(){return!1})},getDatabaseNames:function(t){return _n?_n.getDatabaseNames().then(t):$t.resolve([])},defineClass:function(){return function(t){o(this,t)}},ignoreTransaction:function(t){return Kt.trans?le(Kt.transless,t):t()},vip:xn,async:function(t){return function(){try{var e=In(t.apply(this,arguments));return e&&"function"==typeof e.then?e:$t.resolve(e)}catch(t){return me(t)}}},spawn:function(t,e,n){try{var r=In(t.apply(n,e||[]));return r&&"function"==typeof r.then?r:$t.resolve(r)}catch(t){return me(t)}},currentTransaction:{get:function(){return Kt.trans||null}},waitFor:function(t,e){var n=$t.resolve("function"==typeof t?On.ignoreTransaction(t):t).timeout(e||6e4);return Kt.trans?Kt.trans.waitFor(n):n},Promise:$t,debug:{get:function(){return M},set:function(t){N(t,"dexie"===t?function(){return!0}:Pe)}},derive:h,extend:o,props:c,override:v,Events:Oe,getByKeyPath:_,setByKeyPath:k,delByKeyPath:x,shallowClone:P,deepClone:O,getObjectDiff:D,asap:g,minKey:-1/0,addons:[],connections:we,errnames:Z,dependencies:function(){try{return{indexedDB:i.indexedDB||i.mozIndexedDB||i.webkitIndexedDB||i.msIndexedDB,IDBKeyRange:i.IDBKeyRange||i.webkitIDBKeyRange}}catch(t){return{indexedDB:null,IDBKeyRange:null}}}(),semVer:"3.0.3",version:"3.0.3".split(".").map(function(t){return parseInt(t)}).reduce(function(t,e,n){return t+e/Math.pow(10,2*n)}),default:On,Dexie:On})),On.maxKey=Qe(On.dependencies.IDBKeyRange),function(t){try{_n=function(t){var e,n=t&&"function"==typeof t.databases;if(!n){var r=new En(Ie,{addons:[]});r.version(1).stores({dbnames:"name"}),e=r.table("dbnames")}return{getDatabaseNames:function(){return n?$t.resolve(t.databases()).then(function(t){return t.map(function(t){return t.name}).filter(function(t){return t!==Ie})}):e.toCollection().primaryKeys()},add:function(t){return!n&&t!==Ie&&e.put({name:t}).catch(it)},remove:function(t){return!n&&t!==Ie&&e.delete(t).catch(it)}}}(t)}catch(t){}}(En.dependencies.indexedDB),$t.rejectionMapper=function(t,e){if(!t||t instanceof G||t instanceof TypeError||t instanceof SyntaxError||!t.name||!nt[t.name])return t;var n=new nt[t.name](e||t.message,t);return"stack"in t&&f(n,"stack",{get:function(){return this.inner.stack}}),n},N(M,Pe),En});const $playingBorder="#018a27",$played="#ccffcc",$notDone="#ffffcc",$wishlisted="#ff8a00",$buttonMargin="5px",css='\n.playing {\n  outline: 2px dashed #018a27;\n  position: relative;\n  z-index: 2;\n}\n.played {\n  background-color: #ccffcc;\n}\n.notdone {\n  background-color: #ffffcc;\n}\n#player_bar a.wishlisted {\n  background-color: #ff8a00;\n}\ni.wishlisted {\n  color: #ff8a00;\n  position: absolute;\n  right: 1px;\n  font-size: 20px;\n  top: 1px;\n  z-index: 11;\n}\n#player_backward_button i {\n  padding-right: 4px;\n}\n#player_forward_button i {\n  padding-left: 4px;\n}\ntable.list tr td:first-child a {\n  position: relative;\n}\n#player_bar ul li.right {\n  margin-right: 5px;\n  margin-left: 5px;\n  padding: 0px;\n}\n#player_buy_button {\n  margin-right: 0;\n}\n#player_youtube_button {\n  margin-left: 0;\n}\n#player_info .ellipsis {\n  margin-left: 4px;\n}\n.csstooltip {\n  position: relative;\n  display: inline-block;\n  border-bottom: 1px dotted black;\n}\n.csstooltip .tooltiptext {\n  visibility: hidden;\n  width: 140px;\n  background-color: #1e1e1e;\n  color: #fff;\n  text-align: center;\n  padding: 5px 0;\n  position: absolute;\n  z-index: 9;\n  bottom: 100%;\n  left: 50%;\n  margin-left: -70px;\n  line-height: 26px;\n  border-top-left-radius: 6px;\n  border-top-right-radius: 6px;\n  top: -24px;\n}\n.csstooltip:hover .tooltiptext {\n  visibility: visible;\n}\n.caption-new {\n  display: none;\n  font-family: "nimbus-sans-condensed";\n  position: absolute;\n  font-size: 12px;\n  text-transform: uppercase;\n  font-weight: bold;\n  right: -5px;\n  top: -3px;\n  color: #dbfe01;\n}\n.play-new .caption-new {\n  display: block;\n}\n',element=document.createElement("style");element.id="enhancerCSS",element.innerHTML=css;const header=document.getElementsByTagName("HEAD")[0];function handle(t){return t.then(t=>[null,t]).catch(function(t){return[t,null]})}header.appendChild(element),Array.prototype.last||(Array.prototype.last=function(){return this[this.length-1]}),Array.prototype.random||(Array.prototype.random=function(){return this[Math.floor(Math.random()*this.length)]});class HardstyleComEnhancer{constructor(t){this.pageType,this.items=[],this.playedItems=[],this.albumInfo={},this.playerItem,this.wishlistItem;let e=$.cookie("autoplay");this.autoPlay=e?e-1:"",this.db=t,this.initDB(),this.getPageType(),this.processItems(),this.upgradePlayer(),this.switchAutoPlayCookie()}addClassToDeleteButton(){const t=$(".text-3").toArray();for(const e of t){const t=$(e).children("a").first();t.addClass("delete-button");const n=parseInt(t.attr("onclick").match(/\d+/gi).join(""));t.data("itemId",n),t.removeAttr("onclick")}}addClassToWishlistButton(){const t=$(".text-3").toArray();for(const e of t){const t=$(e).children("a").first();t.addClass("wishlist-button");const n=parseInt(t.attr("onclick").match(/\d+/gi).join(""));t.data("itemId",n),t.removeAttr("onclick")}}callHome(t,e){return new Promise((n,r)=>{$.ajax({type:"GET",url:t,cache:!1,data:{data:e},dataType:"json"}).done(function(t){n(t)}).fail(function(t){r(t)})})}async clearWishlist(t){if(this.pageType="wishlist"){const e=t.currentTarget.href;await this.unwishAll(),window.location.assign(e)}}async constructItem(t){const[e,n]=await handle(this.callHome("https://www.hardstyle.com/call/playlist",{track_id:t}));if(e)return console.log(e);const[r,i]=await handle(this.getRecord("track",t));return r?console.log(r):{type:"track",id:t,title:n.track_title,artist:n.track_artist,mixType:void 0,youtubeLink:this.constructYoutubeLink(n.track_artist,n.track_title),wishlisted:!!i&&i.wishlisted,listenedTo:!!i}}constructYoutubeLink(t,e){return`https://duckduckgo.com/?q=!ducky+youtube+${t.replaceAll(",","").replaceAll(" ","+").replaceAll("&","%26")}+-+${e.replaceAll(",","").replaceAll(" ","+").replaceAll("&","%26")}`}extractId(t){const e=t.split("/").last().split("=").last();return parseInt(e.replace(".html",""))}extractInfo(t){let e=[];const n=$(t).find(".text-1").first().children("a").children().toArray();for(const t of n)e.push($(t).text());return{title:e.shift(),artist:e.pop(),mixType:e.pop()}}switchAutoPlayCookie(){let t;const e=$('<div class="csstooltip"></div>'),n=$('<span class="tooltiptext"></span>'),r=$('<a class="player-button"></a>'),i=$('<i class="fa"><span class="caption-new">new</span></i>');switch(this.autoPlay){case"":case 0:case 5:t=1,i.addClass("fa-list-ul play-new"),n.text("queueing next new track");break;case 1:t=2,i.addClass("fa-list-ol"),n.text("queueing next track");break;case 2:t=3,i.addClass("fa-random play-new"),n.text("shuffling new tracks");break;case 3:t=4,i.addClass("fa-random"),n.text("shuffling all tracks");break;case 4:t=5,i.addClass("fa-stop-circle-o"),n.text("auto play off")}r.html(i),e.append(n),e.append(r),$("#autoPlayContainer").html(e),this.autoPlay=t,$.cookie("autoplay",t,{expires:365,path:"/"})}getItem(t){return this.items.find(e=>e.id===t)}getListenedTracks(){return this.items.filter(t=>t.listenedTo).length}getPageType(){const t=window.location.pathname;switch(!0){case t.includes("top40"):this.pageType="top40";break;case t.includes("charts/album"):this.pageType="topAlbums";break;case t.includes("charts"):this.pageType="charts";break;case t.includes("albums"):this.pageType="album";break;case t.includes("releases"):this.pageType="releases";break;case t.includes("wishlist"):this.pageType="wishlist";break;case t.includes("tracks"):this.pageType="track";break;default:return}}getRecord(t,e){return this.db["album"===t?"albums":"tracks"].where({id:e}).first()}async initDB(){this.db.version(1).stores({tracks:"id,wishlisted",albums:"id,tracksListened,numberOfTracks"})}markRow(t,e,n){if("track"===e)return $(t).addClass("played");if(n.tracksListened){const e=n.tracksListened===n.numberOfTracks?"played":"notdone",r=`Listened to ${n.tracksListened} out of ${n.numberOfTracks} tracks`,i=$("<strong></strong>");i.text(r),i.appendTo($(t).find(".text-1").first().children("a")),$(t).addClass(e)}}async processItems(){if(!this.pageType)return!1;const t=$(".list").find("tr").toArray();let e=0;for(const n of t){let t;if($(n).find(".button.play").length?t="track":($(n).find(".info-button").length||$(n).find(".info").length)&&(t="album"),!t)continue;const r=this.extractId($(n).find("a").first().attr("href")),i=this.extractInfo(n),[o,a]=await handle(this.getRecord(t,r));if(o)return console.log(o);a&&this.markRow(n,t,a);const s={type:t,id:r,...i,youtubeLink:this.constructYoutubeLink(i.artist,i.title),wishlisted:!!a&&a.wishlisted,listenedTo:!(!a||"track"!==t)};this.items.push(s),$(n).attr("data-itemId",r),a&&a.wishlisted&&this.wishlistRow(r,a.wishlisted),e++}if("album"===this.pageType){const t=this.extractId(window.location.href);this.albumInfo={id:t,numberOfTracks:e,tracksListened:this.getListenedTracks()},this.updateAlbumInfo()}else"releases"===this.pageType?this.addClassToWishlistButton():"wishlist"===this.pageType?(this.addClassToDeleteButton(),this.verifyWishlistedItems()):"top40"===this.pageType&&($("#top100").show(),this.scrollTo($("body"),0))}putRecord(t,e){return this.db["album"===t.type?"albums":"tracks"].put(e)}scrollTo(t,e){$([document.documentElement,document.body]).animate({scrollTop:t.offset().top-220},e)}setListened(t){this.getItem(t).listenedTo=!0,"album"===this.pageType&&(this.albumInfo.tracksListened=this.getListenedTracks(),this.updateAlbumInfo())}switchTrack(t,e){let n=this.items.indexOf(this.playerItem);if(n<0||!this.autoPlay)return!1;const r=this.items.length;let i=void 0,o=!0;const a=()=>{for(;o;)if(n+1>=r)i=this.trackItems().find(t=>!1===t.listenedTo),o=!1;else{if(n++,!1!==this.items[n].listenedTo)continue;i=this.items[n],o=!1}return i},s=()=>{if(++n<r)return i=this.items[n],o=!1,i},u=()=>{return this.trackItems().filter(t=>!1===t.listenedTo).random()},c=()=>{return this.trackItems().filter(t=>!this.playedItems.includes(t.id)).random()};if("prev"===t)i=(()=>{if(this.playedItems.length<2)return!1;this.playedItems.pop();const t=this.playedItems.pop();return this.trackItems().find(e=>e.id===t)})();else switch(this.autoPlay){case 1:i=a();break;case 2:i=s();break;case 3:i=u();break;case 4:i=c();break;case 5:i=!e&&s()}if(i){const t=$('tr[data-itemid="'+i.id+'"]');this.scrollTo(t,200),t.find(".play").first().trigger("click")}}trackItems(){return this.items.filter(t=>"track"===t.type)}async unwishAll(){const t=(await handle(this.db.tracks.where({wishlisted:1}).toArray()))[1];for(const e of t){const[t]=await handle(this.db.tracks.update(e.id,{wishlisted:0}));if(t)return console.log(t)}return!0}async updateAlbumInfo(){const[t,e]=await handle(this.putRecord({type:"album",id:this.albumInfo.id},this.albumInfo));if(t)return console.log(e)}updatePlayer(t){const e=this.constructYoutubeLink(t.artist,t.title);$("#player_youtube_button").attr("href",e),$("#player_youtube_button").attr("target","_blank"),$("#player_wishlist_button").data("itemId",t.id),this.playerItem=t,this.playedItems.push(t.id),t.wishlisted?$("#player_wishlist_button").addClass("wishlisted"):$("#player_wishlist_button").removeClass("wishlisted")}updateRecord(t,e){return this.db["album"===t.type?"albums":"tracks"].update(t.id,e)}upgradePlayer(){$("#jp_container_1 li:first").remove(),$("#player_playlist_button").parents("li").remove(),$("#player_share_button").parents("li").remove();const t=$('<li class="right"><a class="player-button" id="player_wishlist_button"><i class="fa fa-star"></i></a></li>');$("#player_buy_button").after(t);const e=$("#player_play_button").parent("li"),n=$('<li class="right"><a id="player_forward_button" class="player-button player-button-round"><i class="fa fa-forward"></i></a></li>');e.before(n);const r=$('<li class="right"><a id="player_backward_button" class="player-button player-button-round"><i class="fa fa-backward"></i></a></li>');e.after(r);const i=$('<li class="right"><a id="player_youtube_button" class="player-button"><i class="fa fa-youtube"></i></a></li>');$("#player_volume_button").parent("li").after(i);const o=$('<li class="right" id="autoPlayContainer"></li>');r.after(o),setTimeout(async()=>{const t=$("#jplayer").data("jPlayer").status.src,e=this.extractId(t);if(!e)return!1;let n=this.getItem(e)||await this.constructItem(e);this.updatePlayer(n)},1e3)}async verifyWishlistedItems(){await this.unwishAll();for(const t of this.items){const[e]=await handle(this.db.tracks.put({id:t.id,wishlisted:1}));if(e)return console.log(e)}}wishlistRow(t,e){if(!$('tr[data-itemid="'+t+'"]').length)return!1;if(e){const e=$('<i class="wishlisted row-wishlist fa fa-star"></i>');$('tr[data-itemid="'+t+'"]').find("td").first().find("a").first().prepend(e)}else{const e=$('tr[data-itemid="'+t+'"]');if("wishlist"===this.pageType)return e.remove();e.find(".row-wishlist").first().remove()}}async wishlistCallComplete(t){if(!this.wishlistItem)return!1;const[e]=await handle(this.updateRecord({type:"track",id:this.wishlistItem.id},{wishlisted:t?1:0}));if(e)return console.log(e);this.wishlistRow(this.wishlistItem.id,t),this.wishlistItem.id===this.playerItem.id&&(this.playerItem.wishlisted=t,this.updatePlayer(this.playerItem)),this.wishlistItem=void 0}async wishlistToggle(t){this.wishlistItem=t;let e=!t.wishlisted,n={track_id:t.id.toString()};e||(n={options:{action:"delete"},...n}),wishlist(void 0,n)}}function start(){const t=new Dexie("HardstyleComDB"),e=new HardstyleComEnhancer(t);$("#jp_container_1").on("click","#autoPlayContainer>.csstooltip>a.player-button",function(t){e.switchAutoPlayCookie()}),$("#player_forward_button").click(function(){e.switchTrack("next")}),$("#player_youtube_button").click(function(){$("#jplayer").jPlayer("pause")}),$("#player_backward_button").click(function(){e.switchTrack("prev")}),$("#player_wishlist_button").click(function(){e.wishlistToggle(e.playerItem)}),$("#column-middle").on("click",".wishlist-button, .delete-button",function(t){t.preventDefault();const n=t.currentTarget,r=$(n).data("itemId"),i=e.getItem(r);return e.wishlistToggle(i),!0}),$(".tracklist-bottom .empty").click(function(t){t.preventDefault(),e.clearWishlist(t)}),$("#jplayer").bind($.jPlayer.event.ended,function(){setTimeout(function(){e.switchTrack("next",!0)},2e3)}),$("#jplayer").bind($.jPlayer.event.play,async function(){const t=$("#jplayer").data("jPlayer").status.src,n=e.extractId(t),r=$(`tr[data-itemid="${n}"]`),i=e.getItem(n),[o]=await handle(e.putRecord({type:"track",id:n},{id:n,wishlisted:i.wishlisted?1:0}));if(o)return console.log(o);e.setListened(n),e.updatePlayer(i),$("table.list tr.playing").removeClass("playing"),r.addClass("playing"),e.markRow(r,"track")}),$(document).ajaxComplete(function(t,n,r){switch(!0){case r.url.includes("call/wishlist"):const t=n.responseJSON.text;"Added to wish list"===t?e.wishlistCallComplete(!0):"Removed from wish list"===t&&e.wishlistCallComplete(!1);break;default:return}})}start();